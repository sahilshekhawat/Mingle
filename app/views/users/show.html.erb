<!-- gmaps4rails////////////////////////////////////////////////////////////////////////////////////////////////// -->
<script src="//maps.google.com/maps/api/js?v=3.13&amp;sensor=false&amp;libraries=geometry" type="text/javascript"></script>
<script src='//google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>
<!-- gmaps4rails////////////////////////////////////////////////////////////////////////////////////////////////// -->

<style>
body {
	background: url(/assets/4.jpg) !important;
}
.icon_container li {
	display: inline;
	float:  left;
	width:15%;
}
</style>
	<div class="page-header">
		<h1><%= @user.name %></h1>
	</div>
	<div class="row">
		<div class="col-xs-6 col-md-3">
			<a href="#" class="thumbnail">
				<img src="assets/11.png">
			</a>
		</div>
	</div>
	<div class = "panel panel-danger">
		<div class = "panel-heading">Personal Details</div>
		<h4 style="font-size:2em;">
			Student ID: <%= @user.roll_no %>
		</h4>
		<h4 style="font-size:2em;">
			Email: <%= @user.email %>
		</h4>
		<h4 style="font-size:2em;">
			Phone: <%= @user.phone %>
		</h4 style="font-size:2em;">
	</div>
	<button class = "btn btn-danger" style = "margin-right: 90%;margin-bottom: 2%;">Edit Profile</button>
	<div class = "panel panel-info">
		<div class = "panel-heading">Timeline (All Travels in +- 5hours)</div>
		<div class = "panel-body">
			<% @user.travel.each do |t| %>
			<% if t.datetime < DateTime.now %>
			<%if (( t.datetime - DateTime.now )/(60*60)).round() > -5%>
			<h5>Travelled from <%= t.from %> to <%= t.to %>
				at <%= t.datetime %> via <%= t.medium %> in about <%= -(( t.datetime - DateTime.now )/(60*60)).round() %> hours from ago
			</h5>
			<% end %>
			<% end %>

			<% if t.datetime > DateTime.now %>
			<%if (( t.datetime - DateTime.now )/(60*60)).round() < 5%>
			<h5>Travelling from <%= t.from %> to <%= t.to %>
				at <%= t.datetime %> via <%= t.medium %> in about <%= (( t.datetime - DateTime.now )/(60*60)).round() %> hours from now
			</h5>
			<% end %>
			<% end %>
			<% end %>
		</div>
	</div>
	<div class = "panel panel-primary">
		<div class = "panel-heading">Your Travels(In last two days)</div>
			<table class = "table">
				<thead>
					<% @user.travel.each do |t| %>
					<% if t.datetime < DateTime.now && ((t.datetime - DateTime.now)/(24*60*60)) > -2%>
					<th>From</th>
					<th>To</th>
					<th>Date & Time</th>
					<th>Medium</th>
				</thead>
				<tbody>
					<td><%= t.from %></td>
					<td><%= t.to %></td>
					<td><%= t.datetime %></td>
					<td><%= t.medium %></td>
					<% end %>
					<% end %>
				</table>
	</div>

	<div class = "panel panel-warning">
		<div class = "panel-heading">Future Travels</div>
		<table class = "table">
			<thead>
				<% @user.travel.each do |t| %>
				<% if t.datetime < DateTime.now && ((t.datetime - DateTime.now)/(24*60*60)) < 5%>
				<th>From</th>
				<th>To</th>
				<th>Date & Time</th>
				<th>Medium</th>
			</thead>
			<tbody>
				<td><%= t.from %></td>
				<td><%= t.to %></td>
				<td><%= t.datetime %></td>
				<td><%= t.medium %></td>
				<% end %>
				<% end %>
			</table>
		</div>




		<div class="row">
			<div id="map_canvas"></div>
		</div>

		<div style='width: 100%;'>
			<div id="directions" style='width: 100%; height: 400px;'></div>
		</div>

		<!-- gmaps4rails////////////////////////////////////////////////////////////////////////////////////////////////// -->

		<script type="text/javascript">
		var directionsDisplay = new google.maps.DirectionsRenderer();
		var directionsService = new google.maps.DirectionsService();

		function calcRoute(flat, flong, tlat, tlong) {
			var origin      = new google.maps.LatLng(flat, flong);
			var destination = new google.maps.LatLng(tlat, tlong);
			var request = {
				origin:      origin,
				destination: destination,
				travelMode:  google.maps.TravelMode.DRIVING
			};
			directionsService.route(request, function(response, status) {
				if (status == google.maps.DirectionsStatus.OK) {
					directionsDisplay.setDirections(response);
				}
			});
		}

		$(document).ready(function(){
			function addDirections(){
				<% @user.travel.each do |travel| %>
				calcRoute("<%= travel.flatitude %>", "<%= travel.flongitude %>", "<%= travel.tlatitude %>", "<%= travel.tlongitude %>");
				<% end %>
			}
			addDirections();
		});

		var handler = Gmaps.build('Google');
		handler.buildMap({ internal: {id: 'directions'}}, function(){
			directionsDisplay.setMap(handler.getMap());
		});

		</script>
		<!-- gmaps4rails////////////////////////////////////////////////////////////////////////////////////////////////// -->
