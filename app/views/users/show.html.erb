<style>
	body {
		background: url(/assets/heyo.jpg) !important;
	}
	.icon_container li {
        display: inline;
        float:  left;
        width:15%;
    }
</style>



<!-- ////////////////////////////////////////////////////////// -->
<style>
    #map_canvas {
      width:800px;
      height: 450px;
}
</style>

<script type="text/javascript">
  function initialize() {
  var mapCanvas = $("#map_canvas")[0];
  var mapOptions = {
    center: new google.maps.LatLng(28.546088, 77.270870),
    zoom: 12,
    mapTypeId: google.maps.MapTypeId.ROADMAPs,
  };

  map = new google.maps.Map(mapCanvas, mapOptions);

  geocoder = new google.maps.Geocoder();
  openInfoWindow = null;
}


function AddRoute(from, to ,user){
  var from_latlng = null;
  geocoder.geocode( {'address': from}, function(results, status){
    if (status == google.maps.GeocoderStatus.OK){
      from_latlng = results[0].geometry.location;
      //map.setCenter(to_latlng);
      var marker = new google.maps.Marker({
        map: map,
        position: from_latlng,
        title: from
      });

      var contentString = '<div id="content" style="max-height:200px; max-width:200px; padding:10px 10px 10px 10px;">'+
          '<div id="siteNotice">'+
          '</div>'+
          '<h4 id="firstHeading" class="firstHeading">'+user+'</h4>'+
          '<div id="bodyContent">'+
          '<p>' + from + '</p>' +
          '</div>'+
          '</div>';
      var info = new google.maps.InfoWindow({
        content: contentString
      });

      google.maps.event.addListener(marker, 'click', function(){
        if (openInfoWindow != null) openInfoWindow.close();
        openInfoWindow = info;
        info.open(map, marker);
      });
    } else {
      console.log("Geocode was not successful for the following reason: " + status);
    }
  });

  var to_latlng = null;
  geocoder.geocode( {'address': to}, function(results, status){
    if (status == google.maps.GeocoderStatus.OK){
      to_latlng = results[0].geometry.location;
      map.setCenter(to_latlng);

      // set here to avoid asynchronous errors
      drawPath(from_latlng, to_latlng);
      
      var marker = new google.maps.Marker({
        map: map,
        position: to_latlng,
        title: to,
        icon: 'http://maps.google.com/mapfiles/ms/icons/green-dot.png',
      });

      var contentString = '<div id="content" style="max-height:200px; max-width:200px; padding:10px 10px 10px 10px;">'+
          '<div id="siteNotice">'+
          '</div>'+
          '<h4 id="firstHeading" class="firstHeading">'+user+'</h4>'+
          '<div id="bodyContent">'+
          '<p>' + to + '</p>' +
          '</div>'+
          '</div>';
      var info = new google.maps.InfoWindow({
        content: contentString
      });


      google.maps.event.addListener(marker, 'click', function(){
        if (openInfoWindow != null) openInfoWindow.close();
        openInfoWindow = info;
        info.open(map, marker);
      });
    } else {
      console.log("Geocode was not successful for the following reason: " + status);
    }
  });


drawPath = function(from, to){
    var directionsDisplay = new google.maps.DirectionsRenderer();
    directionsDisplay.setMap(map);
    var request = {
      origin: from,
      destination: to,
      travelMode: google.maps.TravelMode.DRIVING
    };
    var directionsService = new google.maps.DirectionsService();
  
    directionsService.route(request, function(response, status){
      if (status == google.maps.DirectionsStatus.OK){
        directionsDisplay.setDirections(response);
      }
      else{
        console.log("Error Response from directions service: " + status + response);
      }
  });
  }

}

$(document).ready(function(){
initialize();

function addMarkers(){
<% @user.travel.each do |t| %>
    AddRoute("<%= t.from %>", "<%= t.to %>", "<%= t.user.name %>");
  <% end %>
}
addMarkers();
});
</script>


<!-- ////////////////////////////////////////////////////////// -->

<div class="transblack2">
<div class="page-header">
    <h1 style="color:white;"><%= @user.name %></h1>
</div>

<!-- Blog Layout - START -->
<div class="row wrap">
    <div class="col-sm-3">
        <div class="row" >
                <h2 style="color:white; text-align:center;">Past Travels</h2> (in the last 2 days)
                    <div class="panel-body" >
                    </div>
                        <% @user.travel.each do |t| %>
                        <% if t.datetime < DateTime.now && ((t.datetime - DateTime.now)/(24*60*60)) > -2%>
                        	 
                           <h4 style="color:white;">
                        	 From: <%= t.from %>
                        	 <h4 style="color:white;">
                        	 To: <%= t.to %>
                        	 </h4>
                        	 <h4 style="color:white;">
                        	 Time: <%= t.datetime %>
                        	 </h4>
                        	 <h4 style="color:white;">
                        	 Medium: <%= t.medium %>
                        	 </h4>
                        	 <hr width="40%">
						            <% end %>
                        <% end %>

            <h2 style="color:white; text-align:center;">Future Travels </h2> (in the next 5 days)
                    <div class="panel-body" >                        
                    </div>
                        <% @user.travel.each do |t| %>
                        <% if t.datetime > DateTime.now && (t.datetime - DateTime.now)/(24*60*60)<5 %>
                          <h4 style="color:white;">
                          From: <%= t.from %>
                          <h4 style="color:white;">
                          To: <%= t.to %>
                          </h4>
                          <h4 style="color:white;">
                          Time: <%= t.datetime %>
                          </h4>
                          <h4 style="color:white;">
                          Medium: <%= t.medium %>
                          </h4>
                          <hr width="40%">
            <% end %>
            <% end %>
        </div>

    </div>
    <br><br><br>
    <div class="col-sm-9" style="color:white;">
        <div class="row">
            <div class="col-xs-12">    
            <hr width="50%">
            <div class="row" style="margin: 0 auto;text-align:center;">
                <div class="col-xs-12" >
                    <h4 style="font-size:2em;">
                        Student ID: <%= @user.roll_no %>
                    </h4>
                    <h4 style="font-size:2em;">
                        Email: <%= @user.email %>
                    </h4>
                    <h4 style="font-size:2em;">
                        Phone: <%= @user.phone %>
                    </h4 style="font-size:2em;">

                
            </div>

            <% if @user.id == current_user.id  %><%= link_to 'Edit Profile', edit_user_path(@user) ,:class => "btn btn-info"%> <%end%>	
        </div>
            <hr width="50%">
    </div>
    <h3 style="color:white; text-align:center;">NewsFeeds (travels in +- 5 hours) </h3> 
    <div class="panel-body" >                        
    </div>                        
    <% @user.travel.each do |t| %>
    <% if t.datetime < DateTime.now %>
      <%if (( t.datetime - DateTime.now )/(60*60)).round() > -5%>
        <h5 style="color:white;">Travelled from <%= t.from %> to <%= t.to %>
        at <%= t.datetime %> via <%= t.medium %> in about <%= -(( t.datetime - DateTime.now )/(60*60)).round() %> hours from ago
        </h5>
      <% end %>
    <% end %>

    <% if t.datetime > DateTime.now %>
      <%if (( t.datetime - DateTime.now )/(60*60)).round() < 5%>
        <h5 style="color:white;">Travelling from <%= t.from %> to <%= t.to %>
        at <%= t.datetime %> via <%= t.medium %> in about <%= (( t.datetime - DateTime.now )/(60*60)).round() %> hours from now
        </h5>
      <% end %>
    <% end %>
    <% end %>
        
    <br><br>
    <div class="col-sm-9" style="color:white;">
        <div class="row">
            <div class="col-xs-12">
                
            <div class="row">
                <div id="map_canvas"></div>            
            </div>
        
        </div>
    </div>
<!-- Blog Layout - END -->
</div>